==============================================================================
Navigation Control Panel
==============================================================================

Test setup::

    >>> app = layer['app']
    >>> from plone.testing.z2 import Browser
    >>> browser = Browser(app)
    >>> browser.handleErrors = False
    >>> browser.addHeader('Authorization', 'Basic admin:secret')
    >>> portal = layer['portal']
    >>> from Products.CMFCore.utils import getToolByName
    >>> pprop = getToolByName(portal, 'portal_properties')
    >>> siteProps = pprop['site_properties']
    >>> navProps = pprop['navtree_properties']


Viewing the navigation control panel
------------------------------------

    >>> browser.open('http://nohost/plone/@@navigation-controlpanel')
    >>> browser.url.endswith('navigation-controlpanel')
    True

Click the cancel button:

    >>> browser.getControl(name="form.actions.cancel").click()
    >>> browser.url.endswith('plone_control_panel')
    True

There should be still no changes:

    >>> 'Changes canceled.' in browser.contents
    True

Make some changes
-----------------

    >>> browser.getLink('Navigation').click()
    >>> browser.url.endswith('navigation-controlpanel')
    True

    >>> browser.getControl('Automatically generate tabs').selected = False
    >>> browser.getControl('Generate tabs for items other than folders').selected = False
    >>> browser.getControl('Show items normally excluded from navigation if viewing their children.').selected = False
    >>> browser.getControl('Page').selected = False
    >>> browser.getControl('News Item').selected = False
    >>> browser.getControl('Filter on workflow state').selected = True
    >>> browser.getControl('Private [private]').selected = True

Click the save button:

    >>> browser.getControl("Save").click()
    >>> browser.url.endswith('navigation-controlpanel')
    True

We should be informed that something has changed:

    >>> 'Changes saved.' in browser.contents
    True

Make sure the changes have been applied correctly:

    >>> siteProps.disable_folder_sections
    True

    >>> siteProps.disable_nonfolderish_sections
    True

    >>> navProps.showAllParents
    False

    >>> 'Document' in navProps.metaTypesNotToList
    True

    >>> 'News Item' in navProps.metaTypesNotToList
    True

    >>> navProps.enable_wf_state_filtering
    True

    >>> 'private' in navProps.wf_states_to_show
    True

Make sure, settings in search do not affect the settings in navigation

    >>> browser.open('http://nohost/plone/@@search-controlpanel')
    >>> browser.getControl('Folder').selected = False
    >>> browser.getControl(name="form.actions.save").click()

    >>> browser.open('http://nohost/plone/@@navigation-controlpanel')
    >>> browser.getControl('Folder').selected = False
    >>> browser.getControl("Save").click()
    >>> browser.getControl('Folder').selected
    False

    >>> browser.getControl('Folder').selected = True
    >>> browser.getControl("Save").click()
    >>> browser.getControl('Folder').selected
    True
