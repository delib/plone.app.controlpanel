==============================================================================
Navigation Control Panel
==============================================================================

Test setup::

    >>> app = layer['app']
    >>> from plone.testing.z2 import Browser
    >>> browser = Browser(app)
    >>> browser.handleErrors = False
    >>> browser.addHeader('Authorization', 'Basic admin:secret')
    >>> portal = layer['portal']
    >>> from Products.CMFCore.utils import getToolByName
    >>> pprop = getToolByName(portal, 'portal_properties')
    >>> siteProps = pprop['site_properties']
    >>> navProps = pprop['navtree_properties']


Viewing the navigation control panel
------------------------------------

    >>> browser.open('http://nohost/plone/@@navigation-controlpanel')
    >>> browser.url.endswith('navigation-controlpanel')
    True

Default values:

    >>> browser.getControl('Automatically generate tabs', index=0).selected
    True
    >>> browser.getControl('Generate tabs for items other than folders').selected
    True

Default content types that show up in the navigation:

    >>> browser.getControl('Collection', index=0).selected
    True
    >>> browser.getControl('Comment').selected
    False
    >>> browser.getControl('Event').selected
    True
    >>> browser.getControl('File').selected
    True
    >>> browser.getControl('Folder').selected
    True
    >>> browser.getControl('Image').selected
    True
    >>> browser.getControl('Link').selected
    True
    >>> browser.getControl('News Item').selected
    True
    >>> browser.getControl('Page').selected
    True

Filter on workflow state default values:

    >>> browser.getControl('Filter on workflow state').selected
    False
    >>> browser.getControl('Externally visible [external]').selected
    False
    >>> browser.getControl('Internal draft [internal]').selected
    False
    >>> browser.getControl('Internally published [internally_published]').selected
    False
    >>> browser.getControl('Pending [pending]').selected
    False
    >>> browser.getControl('Private [private]').selected
    False
    >>> browser.getControl('Public draft [visible]').selected
    False
    >>> browser.getControl('Published [published]').selected
    False

Show excluded items default value:

    >>> browser.getControl('Show items normally excluded from navigation if viewing their children.').selected
    True

Click the cancel button:

    >>> browser.getControl(name="form.actions.cancel").click()
    >>> browser.url.endswith('plone_control_panel')
    True

There should be still no changes:

    >>> 'Changes canceled.' in browser.contents
    True


Make some changes
-----------------

    >>> browser.getLink('Navigation').click()
    >>> browser.url.endswith('navigation-controlpanel')
    True

    >>> browser.getControl('Automatically generate tabs', index=0).selected = False
    >>> browser.getControl('Generate tabs for items other than folders').selected = False

    >>> browser.getControl('Collection', index=0).selected = False
    >>> browser.getControl('Comment').selected = True
    >>> browser.getControl('Event').selected = False
    >>> browser.getControl('File').selected = False
    >>> browser.getControl('Folder').selected = False
    >>> browser.getControl('Image').selected = False
    >>> browser.getControl('Link').selected = False
    >>> browser.getControl('News Item').selected = False
    >>> browser.getControl('Page').selected = False

    >>> browser.getControl('Filter on workflow state').selected = True
    >>> browser.getControl('Externally visible [external]').selected = True
    >>> browser.getControl('Internal draft [internal]').selected = True
    >>> browser.getControl('Internally published [internally_published]').selected = True
    >>> browser.getControl('Pending [pending]').selected = True
    >>> browser.getControl('Private [private]').selected = True
    >>> browser.getControl('Public draft [visible]').selected = True
    >>> browser.getControl('Published [published]').selected = True

    >>> browser.getControl('Show items normally excluded from navigation if viewing their children.').selected = False

Click the save button:

    >>> browser.getControl("Save").click()
    >>> browser.url.endswith('navigation-controlpanel')
    True

We should be informed that something has changed:

    >>> 'Changes saved.' in browser.contents
    True

Make sure the changes have been applied correctly:

    >>> siteProps.disable_folder_sections
    True

    >>> siteProps.disable_nonfolderish_sections
    True

    >>> navProps.showAllParents
    False

    >>> 'Document' in navProps.metaTypesNotToList
    True

    >>> 'News Item' in navProps.metaTypesNotToList
    True

    >>> navProps.enable_wf_state_filtering
    True

    >>> 'private' in navProps.wf_states_to_show
    True

Make sure, settings in search do not affect the settings in navigation

    >>> browser.open('http://nohost/plone/@@search-controlpanel')
    >>> browser.getControl('Folder').selected = False
    >>> browser.getControl(name="form.actions.save").click()

    >>> browser.open('http://nohost/plone/@@navigation-controlpanel')
    >>> browser.getControl('Folder').selected = False
    >>> browser.getControl("Save").click()
    >>> browser.getControl('Folder').selected
    False

    >>> browser.getControl('Folder').selected = True
    >>> browser.getControl("Save").click()
    >>> browser.getControl('Folder').selected
    True
