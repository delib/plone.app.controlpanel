Proxy control panel
==================

First some initial setup code:

    >>> from zope.component import getUtility
    >>> from Products.CMFCore.interfaces import IPropertiesTool
    >>> ptool = getUtility(IPropertiesTool)
    >>> self.loginAsManager()

    >>> ptool.site_properties.hasProperty('http_proxy')
    0

Viewing the site control panel
-----------------------------

    >>> self.browser.open('http://nohost/plone/@@proxy-controlpanel')
    >>> self.browser.url
    'http://nohost/plone/@@proxy-controlpanel'

Click the cancel button:

    >>> self.browser.getControl(name="form.actions.cancel").click()
    >>> self.browser.url.endswith('plone_control_panel')
    True

There should be still no changes:

    >>> 'Changes canceled.' in self.browser.contents
    True

Make some changes
-----------------

    >>> self.browser.open('http://nohost/plone/@@proxy-controlpanel')
    >>> self.browser.url.endswith('proxy-controlpanel')
    True

    >>> self.browser.getControl(name='form.http_proxy').value = 'http://www.example.com:3128/'

Click the save button:

    >>> self.browser.getControl(name="form.actions.save").click()
    >>> self.browser.url.endswith('proxy-controlpanel')
    True

We should be informed that something has changed:

    >>> 'Changes saved.' in self.browser.contents
    True

Make sure the changes have been applied correctly to the tool:

    >>> ptool.site_properties.http_proxy
    'http://www.example.com:3128/'

Make some more changes
----------------------

    >>> self.browser.open('http://nohost/plone/@@proxy-controlpanel')
    >>> self.browser.url.endswith('proxy-controlpanel')
    True

    >>> self.browser.getControl(name='form.http_proxy').value = ''

Click the save button:

    >>> self.browser.getControl(name="form.actions.save").click()
    >>> self.browser.url.endswith('proxy-controlpanel')
    True

We should be informed that something has changed:

    >>> 'Changes saved.' in self.browser.contents
    True

Make sure the changes have been applied correctly to the tool:

    >>> ptool.site_properties.hasProperty('http_proxy')
    0
